angular.module("myApp",[]).run(["$window","$translate","$log","realTimeService","randomService",function(a,b,c,d,e){"use strict";function f(d){function f(){for(var a=0;l>a;++a){U[a]=[];for(var b=0;k>b;++b)U[a][b]=0}}function o(a){R=a.yourPlayerIndex,Q=a.playersInfo,S=a.matchController,P=1===Q.length,K=0,J=[];for(var b=0;b<Q.length;b++)J[b]=0;f(),t(),L=(new Date).getTime(),B(),M=requestAnimationFrame(E)}function p(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);J[b]=d.s}function q(a){A(),J=a,O=!1}function r(a){if(!P&&O){var b=angular.toJson({p:K,s:J[R]});a?S.sendReliableMessage(b):S.sendUnreliableMessage(b)}}function s(){O&&(O=!1,S.endMatch(J))}function t(){for(var a=e.randomFromTo(2*K,0,W.length),b=W[a],c=[],d=0;4>d;++d){c[d]=[];for(var f=0;4>f;++f){var g=4*d+f;c[d][f]="undefined"!=typeof b[g]&&b[g]?1:0}}V.shape=c,V.x=4,V.y=0===a?-1:0,V.index=a,K++}function u(a,b,c){a=a||0,b=b||0,a=V.x+a,b=V.y+b,c=c||V.shape;for(var d=V.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof U[e+b]||"undefined"==typeof U[e+b][f+a])return!1;if(U[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&s(),!1}return!0}function v(){if(u(0,1))++V.y;else{if(!O)return;w(),x(),t(),_=!0,z()}}function w(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)V.shape[a][b]&&(U[a+V.y][b+V.x]=V.shape[a][b])}function x(){for(var a=l-1;a>=0;--a){for(var b=!0,c=0;k>c;++c)if(0===U[a][c]){b=!1;break}if(b){J[R]++;for(var d=a;d>0;--d)for(var e=0;k>e;++e)U[d][e]=U[d-1][e];++a}}}function y(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function z(){$=Math.max(100,m-20*Math.floor(K/1))}function A(){cancelAnimationFrame(N)}function B(){cancelAnimationFrame(M)}function C(a,b,c){Y.fillStyle=c,Y.fillRect(a*i,b*j,i-1,j-1),Y.strokeStyle="white",Y.strokeRect(a*i,b*j,i-1,j-1)}function D(){Y.fillStyle="white",Y.fillRect(0,0,g,h),Y.strokeStyle="black",Y.strokeRect(0,0,g,h);for(var a=0;a<J.length;a++){Y.font="10px sans-serif";var c=n[a];Y.fillStyle=c,Y.textBaseline="top";var d=b("COLOR_SCORE_IS",{color:b(c.toUpperCase()),score:""+J[a]}),e=3+a%4*g/(Q.length>4?4:Q.length),f=3+15*Math.floor(a/4);Y.fillText(d,e,f)}var i,j;for(i=0;k>i;++i)for(j=0;l>j;++j)U[j][i]&&C(i,j,n[R]);for(j=0;4>j;++j)for(i=0;4>i;++i)V.shape[j][i]&&C(V.x+i,V.y+j,X[V.index])}function E(){var a=Math.floor(((new Date).getTime()-L)/1e3);if(3>a){D();var c=3-a,d=n[R];Y.fillStyle=d,Y.font="70px sans-serif",Y.fillText(""+c,g/2,h/2),Y.font="19px sans-serif";var e=b("YOUR_TETRIS_COLOR_IS");Y.fillText(e,5,h/4-30),e=b("YOUR_COLOR",{color:b(d.toUpperCase())}),Y.fillText(e,g/2-20,h/4-5),M=requestAnimationFrame(E)}else O=!0,B(),z(),N=requestAnimationFrame(F)}function F(a){if(T.tickStart(),O){0>Z&&(Z=a);var b=a-Z;_=!1,b>=$&&(Z=a,v()),r(_),D(),T.tick(),N=requestAnimationFrame(F)}}function G(a){switch(a){case"left":u(-1)&&--V.x;break;case"right":u(1)&&++V.x;break;case"down":u(0,1)&&++V.y;break;case"up":var b=y(V.shape,V.index);u(0,0,b)&&(V.shape=b)}}function H(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&O&&(G(c),D())}function I(a){if(O){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===aa)return aa=b.pageX,void(ba=b.pageY);var c=b.pageX-aa,d=b.pageY-ba,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(aa=b.pageX,ba=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",G(e),D())}}}c.info("createCanvasController for canvas.id="+d.id);var J,K,L,M,N,O=!1,P=!1,Q=null,R=null,S=null,T=new a.FPSMeter({decimals:0,graph:!0,theme:"dark",left:"5px"}),U=[],V={},W=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],X=["cyan","orange","blue","yellow","red","green","purple"],Y=d.getContext("2d"),Z=-1,$=m,_=!1;document.addEventListener("keydown",H,!1);var aa=null,ba=null;return d.addEventListener("touchstart",function(a){aa=null,ba=null,I(a)},!1),d.addEventListener("touchmove",function(a){I(a)},!1),d.addEventListener("touchend",function(a){I(a)},!1),{gotStartMatch:o,gotMessage:p,gotEndMatch:q}}var g=200,h=400,i=20,j=20,k=g/i,l=h/j,m=400,n=["blue","red","brown","purple","pink","yellow","orange","silver"];d.init({createCanvasController:f,canvasWidth:g,canvasHeight:h})}]);
//# sourceMappingURL=tetris.min.js.map