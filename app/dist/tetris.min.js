angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$translate","$log","realTimeService","randomService",function(a,b,c,d){"use strict";function e(c){function e(){for(var a=0;k>a;++a){T[a]=[];for(var b=0;j>b;++b)T[a][b]=0}}function n(a){L=new window.FPSMeter({graph:!0,theme:"dark",left:"5px"}),R=a.yourPlayerIndex,Q=a.playersInfo,S=a.matchController,P=1===Q.length,J=0,I=[];for(var b=0;b<Q.length;b++)I[b]=0;e(),s(),K=(new Date).getTime(),A(),M=requestAnimationFrame(D)}function o(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);I[b]=d.s}function p(a){z(),I=a,O=!1}function q(a){if(!P&&O){var b=angular.toJson({p:J,s:I[R]});a?S.sendReliableMessage(b):S.sendUnreliableMessage(b)}}function r(){O&&(O=!1,S.endMatch(I))}function s(){for(var a=d.randomFromTo(2*J,0,V.length),b=V[a],c=[],e=0;4>e;++e){c[e]=[];for(var f=0;4>f;++f){var g=4*e+f;c[e][f]="undefined"!=typeof b[g]&&b[g]?1:0}}U.shape=c,U.x=4,U.y=0===a?-1:0,U.index=a,J++}function t(a,b,c){a=a||0,b=b||0,a=U.x+a,b=U.y+b,c=c||U.shape;for(var d=U.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof T[e+b]||"undefined"==typeof T[e+b][f+a])return!1;if(T[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&r(),!1}return!0}function u(){if(t(0,1))++U.y;else{if(!O)return;v(),w(),s(),$=!0,y()}}function v(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)U.shape[a][b]&&(T[a+U.y][b+U.x]=U.shape[a][b])}function w(){for(var a=k-1;a>=0;--a){for(var b=!0,c=0;j>c;++c)if(0===T[a][c]){b=!1;break}if(b){I[R]++;for(var d=a;d>0;--d)for(var e=0;j>e;++e)T[d][e]=T[d-1][e];++a}}}function x(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function y(){Z=Math.max(100,l-20*Math.floor(J/10))}function z(){cancelAnimationFrame(N)}function A(){cancelAnimationFrame(M)}function B(a,b,c){X.fillStyle=c,X.fillRect(a*h,b*i,h-1,i-1),X.strokeStyle="white",X.strokeRect(a*h,b*i,h-1,i-1)}function C(){X.fillStyle="white",X.fillRect(0,0,f,g),X.strokeStyle="black",X.strokeRect(0,0,f,g);for(var b=0;b<I.length;b++){X.font="10px sans-serif";var c=m[b];X.fillStyle=c,X.textBaseline="top";var d=a("COLOR_SCORE_IS",{color:a(c.toUpperCase()),score:""+I[b]}),e=3+b%4*f/(Q.length>4?4:Q.length),h=3+15*Math.floor(b/4);X.fillText(d,e,h)}var i,l;for(i=0;j>i;++i)for(l=0;k>l;++l)T[l][i]&&B(i,l,m[R]);for(l=0;4>l;++l)for(i=0;4>i;++i)U.shape[l][i]&&B(U.x+i,U.y+l,W[U.index])}function D(){L.tickStart();var b=Math.floor(((new Date).getTime()-K)/1e3);if(3>b){C();var c=3-b,d=m[R];X.fillStyle=d,X.font="70px sans-serif",X.fillText(""+c,f/2,g/2),X.font="20px sans-serif";var e=a("YOUR_TETRIS_COLOR_IS");X.fillText(e,20,g/4-30),e=a("YOUR_COLOR",{color:a(d.toUpperCase())}),X.fillText(e,f/2-20,g/4-5),L.tick(),M=requestAnimationFrame(D)}else O=!0,A(),y(),N=requestAnimationFrame(E)}function E(a){if(L.tickStart(),O){0>Y&&(Y=a);var b=a-Y;$=!1,b>=Z&&(Y=a,u()),q($),C(),L.tick(),N=requestAnimationFrame(E)}}function F(a){switch(a){case"left":t(-1)&&--U.x;break;case"right":t(1)&&++U.x;break;case"down":t(0,1)&&++U.y;break;case"up":var b=x(U.shape,U.index);t(0,0,b)&&(U.shape=b)}}function G(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&O&&(F(c),C())}function H(a){if(O){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===_)return _=b.pageX,void(aa=b.pageY);var c=b.pageX-_,d=b.pageY-aa,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(_=b.pageX,aa=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",F(e),C())}}}b.info("createCanvasController for canvas.id="+c.id);var I,J,K,L,M,N,O=!1,P=!1,Q=null,R=null,S=null,T=[],U={},V=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],W=["cyan","orange","blue","yellow","red","green","purple"],X=c.getContext("2d"),Y=-1,Z=l,$=!1;document.addEventListener("keydown",G,!1);var _=null,aa=null;return c.addEventListener("touchstart",function(a){_=null,aa=null,H(a)},!1),c.addEventListener("touchmove",function(a){H(a)},!1),c.addEventListener("touchend",function(a){H(a)},!1),{gotStartMatch:n,gotMessage:o,gotEndMatch:p}}var f=200,g=400,h=20,i=20,j=f/h,k=g/i,l=400,m=["blue","red","brown","purple","pink","yellow","orange","silver"];c.init({createCanvasController:e,canvasWidth:f,canvasHeight:g})}]);
//# sourceMappingURL=tetris.min.js.map