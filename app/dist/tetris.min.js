angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$rootScope","$translate","$log","realTimeService","randomService",function(a,b,c,d,e){"use strict";function f(d){function f(){for(var a=[],b=0;l>b;++b){a[b]=[];for(var c=0;k>c;++c)a[b][c]=0}return a}function r(b){a.isHelpModalShown=!1,W=b.yourPlayerIndex,V=b.playersInfo,X=b.matchController,U=1===V.length,n=U,o=0,p=0,O=0,M=[],N=[];for(var c=0;c<V.length;c++)N[c]=f(),M[c]=0;P=N[W],w(),Q=(new Date).getTime(),E(),R=requestAnimationFrame(H)}function s(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);M[b]=d.s,N[b]=d.b}function t(a){M=a,T=!1,E(),D()}function u(a){if(!U&&T){var b=angular.toJson({p:O,s:M[W],b:P});a?X.sendReliableMessage(b):X.sendUnreliableMessage(b)}}function v(){T&&(T=!1,X.endMatch(M))}function w(){for(var a=e.randomFromTo(2*O,0,Z.length),b=Z[a],c=[],d=0;4>d;++d){c[d]=[];for(var f=0;4>f;++f){var g=4*d+f;c[d][f]="undefined"!=typeof b[g]&&b[g]?1:0}}Y.shape=c,Y.x=4,Y.y=0===a?-1:0,Y.index=a,O++}function x(a,b,c){a=a||0,b=b||0,a=Y.x+a,b=Y.y+b,c=c||Y.shape;for(var d=Y.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof P[e+b]||"undefined"==typeof P[e+b][f+a])return!1;if(P[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&v(),!1}return!0}function y(){if(x(0,1))++Y.y;else{if(!T)return;z(),A(),w(),ca=!0,C()}}function z(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)Y.shape[a][b]&&(P[a+Y.y][b+Y.x]=Y.shape[a][b])}function A(){for(var a=l-1;a>=0;--a){for(var b=!0,c=0;k>c;++c)if(0===P[a][c]){b=!1;break}if(b){M[W]++;for(var d=a;d>0;--d)for(var e=0;k>e;++e)P[d][e]=P[d-1][e];++a}}}function B(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function C(){ba=Math.max(100,m-20*Math.floor(O/10))}function D(){cancelAnimationFrame(S)}function E(){cancelAnimationFrame(R)}function F(a,b,c){_.fillStyle=c,_.fillRect(a*i,b*j,i-1,j-1),_.strokeStyle="white",_.strokeRect(a*i,b*j,i-1,j-1)}function G(){_.fillStyle="white",_.fillRect(0,0,g,h),_.strokeStyle="black",_.strokeRect(0,0,g,h);for(var a=0;a<M.length;a++){_.font="10px sans-serif";var c=q[a];_.fillStyle=c,_.textBaseline="top";var d=b("COLOR_SCORE_IS",{color:b(c.toUpperCase()),score:""+M[a]}),e=3+a%4*g/(V.length>4?4:V.length),f=3+15*Math.floor(a/4);_.fillText(d,e,f)}var i,j;for(i=0;k>i;++i)for(j=0;l>j;++j)P[j][i]&&F(i,j,q[W]);for(j=0;4>j;++j)for(i=0;4>i;++i)Y.shape[j][i]&&F(Y.x+i,Y.y+j,$[Y.index])}function H(){var c=0;if(c=Math.floor(a.isHelpModalShown?(p-o-Q)/1e3:((new Date).getTime()-o-Q)/1e3),3>c){G();var d=3-c,e=q[W];_.fillStyle=e,_.font="70px sans-serif",_.fillText(""+d,g/2,h/2),_.font="20px sans-serif";var f=b("YOUR_TETRIS_COLOR_IS");_.fillText(f,20,h/4-30),f=b("YOUR_COLOR",{color:b(e.toUpperCase())}),_.fillText(f,g/2-20,h/4-5),R=requestAnimationFrame(H)}else T=!0,E(),C(),S=requestAnimationFrame(I)}function I(b){if(T){0>aa&&(aa=b);var c=b-aa;ca=!1,c>=ba&&(aa=b,a.isHelpModalShown||y(),u(ca)),G(),S=requestAnimationFrame(I)}}function J(a){switch(a){case"left":x(-1)&&--Y.x;break;case"right":x(1)&&++Y.x;break;case"down":x(0,1)&&++Y.y;break;case"up":var b=B(Y.shape,Y.index);x(0,0,b)&&(Y.shape=b)}}function K(b){var c=b.which,d=37===c?"left":38===c?"up":39===c?"right":40===c?"down":null;null!==d&&T&&!a.isHelpModalShown&&(J(d),G())}function L(a){if(T){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===da)return da=b.pageX,void(ea=b.pageY);var c=b.pageX-da,d=b.pageY-ea,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(da=b.pageX,ea=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",J(e),G())}}}c.info("createCanvasController for canvas.id="+d.id);var M,N,O,P,Q,R,S,T=!1,U=!1,V=null,W=null,X=null,Y={},Z=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],$=["cyan","orange","blue","yellow","red","green","purple"],_=d.getContext("2d"),aa=-1,ba=m;a.stopDrawInterval=D;var ca=!1;a.updateAndDraw=I,document.addEventListener("keydown",K,!1);var da=null,ea=null;return d.addEventListener("touchstart",function(a){da=null,ea=null,L(a)},!1),d.addEventListener("touchmove",function(a){L(a)},!1),d.addEventListener("touchend",function(a){L(a)},!1),{gotStartMatch:r,gotMessage:s,gotEndMatch:t}}var g=200,h=400,i=20,j=20,k=g/i,l=h/j,m=400;a.isHelpModalShown=!1;var n=!1,o=0,p=0;a.carouselClick=function(){n&&(a.isHelpModalShown=!0,p=(new Date).getTime())},a.carouselClose=function(){a.isHelpModalShown=!1,o+=(new Date).getTime()-p};var q=["blue","red","brown","purple","pink","yellow","orange","silver"];d.init({createCanvasController:f,canvasWidth:g,canvasHeight:h})}]);
//# sourceMappingURL=tetris.min.js.map