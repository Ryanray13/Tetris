angular.module("myApp",[]).run(["$translate","$log","realTimeService","randomService",function(a,b,c,d){"use strict";function e(c){function e(){for(var a=0;l>a;++a){R[a]=[];for(var b=0;k>b;++b)R[a][b]=0}}function o(a){P=a.yourPlayerIndex,O=a.playersInfo,Q=a.matchController,N=1===O.length,K=0,J=[];for(var b=0;b<O.length;b++)J[b]=0;e(),t(),L=(new Date).getTime(),B(),V=requestAnimationFrame(E)}function p(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);J[b]=d.s}function q(a){A(),J=a,M=!1}function r(a){if(!N&&M){var b=angular.toJson({p:K,s:J[P]});a?Q.sendReliableMessage(b):Q.sendUnreliableMessage(b)}}function s(){M&&(M=!1,Q.endMatch(J))}function t(){for(var a=d.randomFromTo(2*K,0,T.length),b=T[a],c=[],e=0;4>e;++e){c[e]=[];for(var f=0;4>f;++f){var g=4*e+f;c[e][f]="undefined"!=typeof b[g]&&b[g]?1:0}}S.shape=c,S.x=4,S.y=0===a?-1:0,S.index=a,K++}function u(a,b,c){a=a||0,b=b||0,a=S.x+a,b=S.y+b,c=c||S.shape;for(var d=S.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof R[e+b]||"undefined"==typeof R[e+b][f+a])return!1;if(R[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&s(),!1}return!0}function v(){if(u(0,1))++S.y;else{if(!M)return;w(),x(),t(),$=!0,z()}}function w(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)S.shape[a][b]&&(R[a+S.y][b+S.x]=S.shape[a][b])}function x(){for(var a=l-1;a>=0;--a){for(var b=!0,c=0;k>c;++c)if(0===R[a][c]){b=!1;break}if(b){J[P]++;for(var d=a;d>0;--d)for(var e=0;k>e;++e)R[d][e]=R[d-1][e];++a}}}function y(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function z(){Z=Math.max(100,m-20*Math.floor(K/10))}function A(){cancelAnimationFrame(W)}function B(){cancelAnimationFrame(V)}function C(a,b,c){X.fillStyle=c,X.fillRect(a*i,b*j,i-1,j-1),X.strokeStyle="white",X.strokeRect(a*i,b*j,i-1,j-1)}function D(){X.fillStyle="white",X.fillRect(0,0,g,h),X.strokeStyle="black",X.strokeRect(0,0,g,h);for(var b=0;b<J.length;b++){X.font="10px sans-serif";var c=n[b];X.fillStyle=c,X.textBaseline="top";var d=a("COLOR_SCORE_IS",{color:a(c.toUpperCase()),score:""+J[b]}),e=3+b%4*g/(O.length>4?4:O.length),f=3+15*Math.floor(b/4);X.fillText(d,e,f)}var i,j;for(i=0;k>i;++i)for(j=0;l>j;++j)R[j][i]&&C(i,j,n[P]);for(j=0;4>j;++j)for(i=0;4>i;++i)S.shape[j][i]&&C(S.x+i,S.y+j,U[S.index])}function E(){f.tickStart();var b=Math.floor(((new Date).getTime()-L)/1e3);if(3>b){D();var c=3-b,d=n[P];X.fillStyle=d,X.font="70px sans-serif",X.fillText(""+c,g/2,h/2),X.font="19px sans-serif";var e=a("YOUR_TETRIS_COLOR_IS");X.fillText(e,5,h/4-30),e=a("YOUR_COLOR",{color:a(d.toUpperCase())}),X.fillText(e,g/2-20,h/4-5),f.tick(),V=requestAnimationFrame(E)}else M=!0,B(),z(),W=requestAnimationFrame(F)}function F(a){if(f.tickStart(),M){0>Y&&(Y=a);var b=a-Y;$=!1,b>=Z&&(Y=a,v()),r($),D(),f.tick(),W=requestAnimationFrame(F)}}function G(a){switch(a){case"left":u(-1)&&--S.x;break;case"right":u(1)&&++S.x;break;case"down":u(0,1)&&++S.y;break;case"up":var b=y(S.shape,S.index);u(0,0,b)&&(S.shape=b)}}function H(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&M&&(G(c),D())}function I(a){if(M){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===_)return _=b.pageX,void(aa=b.pageY);var c=b.pageX-_,d=b.pageY-aa,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(_=b.pageX,aa=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",G(e),D())}}}b.info("createCanvasController for canvas.id="+c.id);var J,K,L,M=!1,N=!1,O=null,P=null,Q=null,R=[],S={},T=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],U=["cyan","orange","blue","yellow","red","green","purple"];f=new window.FPSMeter({graph:!0,theme:"dark",left:"5px"});var V,W,X=c.getContext("2d"),Y=-1,Z=m,$=!1;document.addEventListener("keydown",H,!1);var _=null,aa=null;return c.addEventListener("touchstart",function(a){_=null,aa=null,I(a)},!1),c.addEventListener("touchmove",function(a){I(a)},!1),c.addEventListener("touchend",function(a){I(a)},!1),{gotStartMatch:o,gotMessage:p,gotEndMatch:q}}var f,g=200,h=400,i=20,j=20,k=g/i,l=h/j,m=400,n=["blue","red","brown","purple","pink","yellow","orange","silver"];c.init({createCanvasController:e,canvasWidth:g,canvasHeight:h})}]);
//# sourceMappingURL=tetris.min.js.map