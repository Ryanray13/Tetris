angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$rootScope","$translate","$log","realTimeService","randomService",function(a,b,c,d,e){"use strict";function f(d){function f(){for(var a=[],b=0;l>b;++b){a[b]=[];for(var c=0;k>c;++c)a[b][c]=0}return a}function r(a){R=new window.FPSMeter({graph:!0,theme:"dark",left:"5px"}),X=a.yourPlayerIndex,W=a.playersInfo,Y=a.matchController,V=1===W.length,n=V,O=0,M=[],N=[];for(var b=0;b<W.length;b++)N[b]=f(),M[b]=0;P=N[X],w(),Q=(new Date).getTime(),E(),S=requestAnimationFrame(H)}function s(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);M[b]=d.s,N[b]=d.b}function t(a){D(),M=a,U=!1}function u(a){if(!V&&U){var b=angular.toJson({p:O,s:M[X],b:P});a?Y.sendReliableMessage(b):Y.sendUnreliableMessage(b)}}function v(){U&&(U=!1,Y.endMatch(M))}function w(){for(var a=e.randomFromTo(2*O,0,$.length),b=$[a],c=[],d=0;4>d;++d){c[d]=[];for(var f=0;4>f;++f){var g=4*d+f;c[d][f]="undefined"!=typeof b[g]&&b[g]?1:0}}Z.shape=c,Z.x=4,Z.y=0===a?-1:0,Z.index=a,O++}function x(a,b,c){a=a||0,b=b||0,a=Z.x+a,b=Z.y+b,c=c||Z.shape;for(var d=Z.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof P[e+b]||"undefined"==typeof P[e+b][f+a])return!1;if(P[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&v(),!1}return!0}function y(){if(x(0,1))++Z.y;else{if(!U)return;z(),A(),w(),da=!0,C()}}function z(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)Z.shape[a][b]&&(P[a+Z.y][b+Z.x]=Z.shape[a][b])}function A(){for(var a=l-1;a>=0;--a){for(var b=!0,c=0;k>c;++c)if(0===P[a][c]){b=!1;break}if(b){M[X]++;for(var d=a;d>0;--d)for(var e=0;k>e;++e)P[d][e]=P[d-1][e];++a}}}function B(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function C(){ca=Math.max(100,m-20*Math.floor(O/10))}function D(){cancelAnimationFrame(T)}function E(){cancelAnimationFrame(S)}function F(a,b,c){aa.fillStyle=c,aa.fillRect(a*i,b*j,i-1,j-1),aa.strokeStyle="white",aa.strokeRect(a*i,b*j,i-1,j-1)}function G(){aa.fillStyle="white",aa.fillRect(0,0,g,h),aa.strokeStyle="black",aa.strokeRect(0,0,g,h);for(var a=0;a<M.length;a++){aa.font="10px sans-serif";var c=q[a];aa.fillStyle=c,aa.textBaseline="top";var d=b("COLOR_SCORE_IS",{color:b(c.toUpperCase()),score:""+M[a]}),e=3+a%4*g/(W.length>4?4:W.length),f=3+15*Math.floor(a/4);aa.fillText(d,e,f)}var i,j;for(i=0;k>i;++i)for(j=0;l>j;++j)P[j][i]&&F(i,j,q[X]);for(j=0;4>j;++j)for(i=0;4>i;++i)Z.shape[j][i]&&F(Z.x+i,Z.y+j,_[Z.index])}function H(){R.tickStart();var c=0;if(c=Math.floor(a.isHelpModalShown?(p-o-Q)/1e3:((new Date).getTime()-o-Q)/1e3),3>c){G();var d=3-c,e=q[X];aa.fillStyle=e,aa.font="70px sans-serif",aa.fillText(""+d,g/2,h/2),aa.font="20px sans-serif";var f=b("YOUR_TETRIS_COLOR_IS");aa.fillText(f,20,h/4-30),f=b("YOUR_COLOR",{color:b(e.toUpperCase())}),aa.fillText(f,g/2-20,h/4-5),R.tick(),S=requestAnimationFrame(H)}else U=!0,E(),C(),T=requestAnimationFrame(I)}function I(b){if(R.tickStart(),U){0>ba&&(ba=b);var c=b-ba;da=!1,c>=ca&&(ba=b,a.isHelpModalShown||y(),u(da)),G(),R.tick(),T=requestAnimationFrame(I)}}function J(a){switch(a){case"left":x(-1)&&--Z.x;break;case"right":x(1)&&++Z.x;break;case"down":x(0,1)&&++Z.y;break;case"up":var b=B(Z.shape,Z.index);x(0,0,b)&&(Z.shape=b)}}function K(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&U&&(J(c),G())}function L(a){if(U){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===ea)return ea=b.pageX,void(fa=b.pageY);var c=b.pageX-ea,d=b.pageY-fa,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(ea=b.pageX,fa=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",J(e),G())}}}c.info("createCanvasController for canvas.id="+d.id);var M,N,O,P,Q,R,S,T,U=!1,V=!1,W=null,X=null,Y=null,Z={},$=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],_=["cyan","orange","blue","yellow","red","green","purple"],aa=d.getContext("2d"),ba=-1,ca=m;a.stopDrawInterval=D;var da=!1;a.updateAndDraw=I,document.addEventListener("keydown",K,!1);var ea=null,fa=null;return d.addEventListener("touchstart",function(a){ea=null,fa=null,L(a)},!1),d.addEventListener("touchmove",function(a){L(a)},!1),d.addEventListener("touchend",function(a){L(a)},!1),{gotStartMatch:r,gotMessage:s,gotEndMatch:t}}var g=200,h=400,i=20,j=20,k=g/i,l=h/j,m=400;a.isHelpModalShown=!1;var n=!1,o=0,p=0;a.carouselClick=function(){n&&(a.isHelpModalShown=!0,p=(new Date).getTime())},a.carouselClose=function(){a.isHelpModalShown=!1,o+=(new Date).getTime()-p};var q=["blue","red","brown","purple","pink","yellow","orange","silver"];d.init({createCanvasController:f,canvasWidth:g,canvasHeight:h})}]);
//# sourceMappingURL=tetris.min.js.map