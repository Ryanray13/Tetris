angular.module("myApp",["ngTouch","ui.bootstrap"]).run(["$rootScope","$translate","$log","realTimeService","randomService",function(a,b,c,d,e){"use strict";function f(d){function f(){for(var a=0;l>a;++a){X[a]=[];for(var b=0;k>b;++b)X[a][b]=0}}function r(a){P=new window.FPSMeter({graph:!0,theme:"dark",left:"5px"}),V=a.yourPlayerIndex,U=a.playersInfo,W=a.matchController,T=1===U.length,n=T,N=0,M=[];for(var b=0;b<U.length;b++)M[b]=0;f(),w(),O=(new Date).getTime(),E(),Q=requestAnimationFrame(H)}function s(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);M[b]=d.s}function t(a){D(),M=a,S=!1}function u(a){if(!T&&S){var b=angular.toJson({p:N,s:M[V]});a?W.sendReliableMessage(b):W.sendUnreliableMessage(b)}}function v(){S&&(S=!1,W.endMatch(M))}function w(){for(var a=e.randomFromTo(2*N,0,Z.length),b=Z[a],c=[],d=0;4>d;++d){c[d]=[];for(var f=0;4>f;++f){var g=4*d+f;c[d][f]="undefined"!=typeof b[g]&&b[g]?1:0}}Y.shape=c,Y.x=4,Y.y=0===a?-1:0,Y.index=a,N++}function x(a,b,c){a=a||0,b=b||0,a=Y.x+a,b=Y.y+b,c=c||Y.shape;for(var d=Y.index,e=0;4>e;++e)for(var f=0;4>f;++f)if(c[e][f]){if("undefined"==typeof X[e+b]||"undefined"==typeof X[e+b][f+a])return!1;if(X[e+b][f+a])return(0!==d&&1===b||0===d&&0===b)&&v(),!1}return!0}function y(){if(x(0,1))++Y.y;else{if(!S)return;z(),A(),w(),ca=!0,C()}}function z(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)Y.shape[a][b]&&(X[a+Y.y][b+Y.x]=Y.shape[a][b])}function A(){for(var a=l-1;a>=0;--a){for(var b=!0,c=0;k>c;++c)if(0===X[a][c]){b=!1;break}if(b){M[V]++;for(var d=a;d>0;--d)for(var e=0;k>e;++e)X[d][e]=X[d-1][e];++a}}}function B(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function C(){ba=Math.max(100,m-20*Math.floor(N/10))}function D(){cancelAnimationFrame(R)}function E(){cancelAnimationFrame(Q)}function F(a,b,c){_.fillStyle=c,_.fillRect(a*i,b*j,i-1,j-1),_.strokeStyle="white",_.strokeRect(a*i,b*j,i-1,j-1)}function G(){_.fillStyle="white",_.fillRect(0,0,g,h),_.strokeStyle="black",_.strokeRect(0,0,g,h);for(var a=0;a<M.length;a++){_.font="10px sans-serif";var c=q[a];_.fillStyle=c,_.textBaseline="top";var d=b("COLOR_SCORE_IS",{color:b(c.toUpperCase()),score:""+M[a]}),e=3+a%4*g/(U.length>4?4:U.length),f=3+15*Math.floor(a/4);_.fillText(d,e,f)}var i,j;for(i=0;k>i;++i)for(j=0;l>j;++j)X[j][i]&&F(i,j,q[V]);for(j=0;4>j;++j)for(i=0;4>i;++i)Y.shape[j][i]&&F(Y.x+i,Y.y+j,$[Y.index])}function H(){P.tickStart();var c=0;if(c=Math.floor(a.isHelpModalShown?(p-o-O)/1e3:((new Date).getTime()-o-O)/1e3),3>c){G();var d=3-c,e=q[V];_.fillStyle=e,_.font="70px sans-serif",_.fillText(""+d,g/2,h/2),_.font="20px sans-serif";var f=b("YOUR_TETRIS_COLOR_IS");_.fillText(f,20,h/4-30),f=b("YOUR_COLOR",{color:b(e.toUpperCase())}),_.fillText(f,g/2-20,h/4-5),P.tick(),Q=requestAnimationFrame(H)}else S=!0,E(),C(),R=requestAnimationFrame(I)}function I(b){if(P.tickStart(),S){0>aa&&(aa=b);var c=b-aa;ca=!1,c>=ba&&(aa=b,a.isHelpModalShown||y()),u(ca),G(),P.tick(),R=requestAnimationFrame(I)}}function J(a){switch(a){case"left":x(-1)&&--Y.x;break;case"right":x(1)&&++Y.x;break;case"down":x(0,1)&&++Y.y;break;case"up":var b=B(Y.shape,Y.index);x(0,0,b)&&(Y.shape=b)}}function K(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&S&&(J(c),G())}function L(a){if(S){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===da)return da=b.pageX,void(ea=b.pageY);var c=b.pageX-da,d=b.pageY-ea,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(da=b.pageX,ea=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",J(e),G())}}}c.info("createCanvasController for canvas.id="+d.id);var M,N,O,P,Q,R,S=!1,T=!1,U=null,V=null,W=null,X=[],Y={},Z=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],$=["cyan","orange","blue","yellow","red","green","purple"],_=d.getContext("2d"),aa=-1,ba=m;a.stopDrawInterval=D;var ca=!1;a.updateAndDraw=I,document.addEventListener("keydown",K,!1);var da=null,ea=null;return d.addEventListener("touchstart",function(a){da=null,ea=null,L(a)},!1),d.addEventListener("touchmove",function(a){L(a)},!1),d.addEventListener("touchend",function(a){L(a)},!1),{gotStartMatch:r,gotMessage:s,gotEndMatch:t}}var g=200,h=400,i=20,j=20,k=g/i,l=h/j,m=400;a.isHelpModalShown=!1;var n=!1,o=0,p=0;a.carouselClick=function(){n&&(a.isHelpModalShown=!0,p=(new Date).getTime())},a.carouselClose=function(){a.isHelpModalShown=!1,o+=(new Date).getTime()-p};var q=["blue","red","brown","purple","pink","yellow","orange","silver"];d.init({createCanvasController:f,canvasWidth:g,canvasHeight:h})}]);
//# sourceMappingURL=tetris.min.js.map