angular.module("myApp",[]).run(["$translate","$log","realTimeService","randomService",function(a,b,c,d){"use strict";function e(c){function e(){for(var a=0;k>a;++a){S[a]=[];for(var b=0;j>b;++b)S[a][b]=0}}function n(a){Q=a.yourPlayerIndex,P=a.playersInfo,R=a.matchController,O=1===P.length,J=0,I=[];for(var b=0;b<P.length;b++)I[b]=0;e(),s(),K=(new Date).getTime(),A(),L=requestAnimationFrame(D)}function o(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);I[b]=d.s}function p(a){z(),I=a,N=!1}function q(a){if(!O&&N){var b=angular.toJson({p:J,s:I[Q]});a?R.sendReliableMessage(b):R.sendUnreliableMessage(b)}}function r(){N&&(N=!1,R.endMatch(I))}function s(){for(var a=d.randomFromTo(2*J,0,U.length),b=U[a],c=[],e=0;4>e;++e){c[e]=[];for(var f=0;4>f;++f){var g=4*e+f;c[e][f]="undefined"!=typeof b[g]&&b[g]?1:0}}T.shape=c,T.x=4,T.y=0===a?-1:0,T.index=a,J++}function t(a,b,c){a=a||0,b=b||0,a=T.x+a,b=T.y+b,c=c||T.shape,console.log(T);for(var d=0;4>d;++d)for(var e=0;4>e;++e)if(c[d][e]&&("undefined"==typeof S[d+b]||"undefined"==typeof S[d+b][e+a]||S[d+b][e+a]||0>e+a||d+b>=k||e+a>=j))return console.log(a+" "+b),e+a>=0&&j>e+a&&k>d+b&&S[d+b][e+a]&&1===b&&(z(),r()),!1;return!0}function u(){if(t(0,1))++T.y;else{if(!N)return;v(),w(),s(),Z=!0,y()}}function v(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)T.shape[a][b]&&(S[a+T.y][b+T.x]=T.shape[a][b])}function w(){for(var a=k-1;a>=0;--a){for(var b=!0,c=0;j>c;++c)if(0===S[a][c]){b=!1;break}if(b){I[Q]++;for(var d=a;d>0;--d)for(var e=0;j>e;++e)S[d][e]=S[d-1][e];++a}}}function x(a,b){if(3===b)return angular.copy(a);var c,d,e=[];if(0===b)for(d=0;4>d;++d)for(e[d]=[],c=0;4>c;++c)e[d][c]=a[3-c][d];else for(d=0;4>d;++d)for(e[d]=[],c=0;3>c;++c)e[d][c]=a[2-c][d];return e}function y(){z(),Y=Math.max(100,l-20*Math.floor(J/10)),M=requestAnimationFrame(E)}function z(){cancelAnimationFrame(M)}function A(){cancelAnimationFrame(L)}function B(a,b,c){W.fillStyle=c,W.fillRect(a*h,b*i,h-1,i-1),W.strokeStyle="white",W.strokeRect(a*h,b*i,h-1,i-1)}function C(){W.fillStyle="white",W.fillRect(0,0,f,g),W.strokeStyle="black",W.strokeRect(0,0,f,g);for(var b=0;b<I.length;b++){W.font="10px sans-serif";var c=m[b];W.fillStyle=c,W.textBaseline="top";var d=a("COLOR_SCORE_IS",{color:a(c.toUpperCase()),score:""+I[b]}),e=3+b%4*f/(P.length>4?4:P.length),h=3+15*Math.floor(b/4);W.fillText(d,e,h)}var i,l;for(i=0;j>i;++i)for(l=0;k>l;++l)S[l][i]&&B(i,l,m[Q]);for(l=0;4>l;++l)for(i=0;4>i;++i)T.shape[l][i]&&B(T.x+i,T.y+l,V[T.index])}function D(){var b=Math.floor(((new Date).getTime()-K)/1e3);if(3>b){C();var c=3-b,d=m[Q];W.fillStyle=d,W.font="70px sans-serif",W.fillText(""+c,f/2,g/2),W.font="19px sans-serif";var e=a("YOUR_TETRIS_COLOR_IS");W.fillText(e,5,g/4-30),e=a("YOUR_COLOR",{color:a(d.toUpperCase())}),W.fillText(e,f/2-20,g/4-5),L=requestAnimationFrame(D)}else N=!0,A(),y()}function E(a){if(N){0>X&&(X=a);var b=a-X;Z=!1,b>=Y&&(X=a,u()),q(Z),C(),M=requestAnimationFrame(E)}}function F(a){switch(a){case"left":t(-1)&&--T.x;break;case"right":t(1)&&++T.x;break;case"down":t(0,1)&&++T.y;break;case"up":var b=x(T.shape,T.index);t(0,0,b)&&(T.shape=b)}}function G(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&N&&(F(c),C())}function H(a){if(N){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===$)return $=b.pageX,void(_=b.pageY);var c=b.pageX-$,d=b.pageY-_,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&($=b.pageX,_=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",F(e),C())}}}b.info("createCanvasController for canvas.id="+c.id);var I,J,K,L,M,N=!1,O=!1,P=null,Q=null,R=null,S=[],T={},U=[[0,0,0,0,1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],V=["cyan","orange","blue","yellow","red","green","purple"],W=c.getContext("2d"),X=-1,Y=l,Z=!1;document.addEventListener("keydown",G,!1);var $=null,_=null;return c.addEventListener("touchstart",function(a){$=null,_=null,H(a)},!1),c.addEventListener("touchmove",function(a){H(a)},!1),c.addEventListener("touchend",function(a){H(a)},!1),{gotStartMatch:n,gotMessage:o,gotEndMatch:p}}var f=200,g=400,h=20,i=20,j=f/h,k=g/i,l=400,m=["blue","red","brown","purple","pink","yellow","orange","silver"];c.init({createCanvasController:e,canvasWidth:f,canvasHeight:g})}]);
//# sourceMappingURL=tetris.min.js.map