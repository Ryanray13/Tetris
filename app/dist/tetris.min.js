angular.module("myApp",[]).run(["$translate","$log","realTimeService","randomService",function(a,b,c,d){"use strict";function e(c){function e(){for(var a=0;k>a;++a){O[a]=[];for(var b=0;j>b;++b)O[a][b]=0}}function n(a){M=a.yourPlayerIndex,L=a.playersInfo,N=a.matchController,J=!0,K=1===L.length,G=0,F=[];for(var b=0;b<L.length;b++)F[b]=0;e(),s(),H=(new Date).getTime(),y()}function o(a){var b=a.fromPlayerIndex,c=a.message,d=angular.fromJson(c);for(F[b]=d.s;G<d.p;)s()}function p(a){F=a,J=!1,z()}function q(a){if(!K&&J){var b=angular.toJson({p:G,s:F[M]});a?N.sendReliableMessage(b):N.sendUnreliableMessage(b)}}function r(){J&&(J=!1,N.endMatch(F))}function s(){for(var a=d.randomFromTo(2*G,0,Q.length),b=Q[a],c=[],e=0;4>e;++e){c[e]=[];for(var f=0;4>f;++f){var g=4*e+f;c[e][f]="undefined"!=typeof b[g]&&b[g]?1:0}}P.shape=c,P.x=4,P.y=0,P.index=a,G++}function t(a,b,c){a=a||0,b=b||0,a=P.x+a,b=P.y+b,c=c||P.shape;for(var d=0;4>d;++d)for(var e=0;4>e;++e)if(c[d][e]&&("undefined"==typeof O[d+b]||"undefined"==typeof O[d+b][e+a]||O[d+b][e+a]||0>e+a||d+b>=k||e+a>=j))return 1===b&&r(),!1;return!0}function u(){t(0,1)?++P.y:(v(),w(),s())}function v(){for(var a=0;4>a;++a)for(var b=0;4>b;++b)P.shape[a][b]&&(O[a+P.y][b+P.x]=P.shape[a][b])}function w(){for(var a=k-1;a>=0;--a){for(var b=!0,c=0;j>c;++c)if(0===O[a][c]){b=!1;break}if(b){F[M]++,document.getElementById("clearsound").play();for(var d=a;d>0;--d)for(var e=0;j>e;++e)O[d][e]=O[d-1][e];++a}}}function x(a){for(var b=[],c=0;4>c;++c){b[c]=[];for(var d=0;4>d;++d)b[c][d]=a[3-d][c]}return b}function y(){z();var a=Math.max(100,l-20*Math.floor(G/10));I=setInterval(C,a)}function z(){clearInterval(I)}function A(a,b,c){S.fillStyle=c,S.fillRect(a*h,b*i,h-1,i-1),S.strokeStyle="white",S.strokeRect(a*h,b*i,h-1,i-1)}function B(){S.fillStyle="white",S.fillRect(0,0,f,g),S.strokeStyle="black",S.strokeRect(0,0,f,g);var b,c;for(b=0;j>b;++b)for(c=0;k>c;++c)O[c][b]&&A(b,c,m[M]);for(c=0;4>c;++c)for(b=0;4>b;++b)P.shape[c][b]&&A(P.x+b,P.y+c,R[P.index]);for(var d=0;d<F.length;d++){S.font="12px sans-serif";var e=m[d];S.fillStyle=e,S.textBaseline="top";var h=a.instant("COLOR_SCORE_IS",{color:a.instant(e.toUpperCase()),score:""+F[d]}),i=5+d%4*f/(L.length>4?4:L.length),l=5+15*Math.floor(d/4);S.fillText(h,i,l)}}function C(){if(J){var b=Math.floor(((new Date).getTime()-H)/1e3);if(3>b){B();var c=3-b,d=m[M];S.fillStyle=d,S.font="70px sans-serif",S.fillText(""+c,f/2,g/2),S.font="20px sans-serif";var e=a.instant("YOUR_SNAKE_COLOR_IS");return S.fillText(e,f/4-35,g/4-30),e=a.instant("YOUR_COLOR",{color:a.instant(d.toUpperCase())}),void S.fillText(e,f/2-20,g/4-5)}u();var h=!0;q(h),B()}}function D(a){switch(a){case"left":t(-1)&&--P.x;break;case"right":t(1)&&++P.x;break;case"down":t(0,1)&&++P.y;break;case"up":var b=x(P.shape);t(0,0,b)&&(P.shape=b)}}function E(a){a.preventDefault();var b=a.targetTouches[0];if(b){if(null===T)return T=b.pageX,void(U=b.pageY);var c=b.pageX-T,d=b.pageY-U,e=null,f=Math.abs(c),g=Math.abs(d);(f>=20||g>=20)&&(T=b.pageX,U=b.pageY,e=f>g?0>c?"left":"right":0>d?"up":"down",D(e),B())}}b.info("createCanvasController for canvas.id="+c.id);var F,G,H,I,J=!1,K=!1,L=null,M=null,N=null,O=[],P={},Q=[[1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],R=["cyan","orange","blue","yellow","red","green","purple"],S=c.getContext("2d");document.addEventListener("keydown",function(a){var b=a.which,c=37===b?"left":38===b?"up":39===b?"right":40===b?"down":null;null!==c&&(D(c),B())},!1);var T=null,U=null;return c.addEventListener("touchstart",function(a){T=null,U=null,E(a)},!1),c.addEventListener("touchmove",function(a){E(a)},!1),c.addEventListener("touchend",function(a){E(a)},!1),{gotStartMatch:n,gotMessage:o,gotEndMatch:p}}var f=200,g=400,h=20,i=20,j=f/h,k=g/i,l=400,m=["blue","red","brown","purple","pink","yellow","orange","silver"];c.init({createCanvasController:e,canvasWidth:f,canvasHeight:g})}]).config(["$translateProvider",function(a){"use strict";a.init(["en","he"])}]);
//# sourceMappingURL=tetris.min.js.map